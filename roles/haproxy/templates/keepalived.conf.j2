vrrp_track_process track_haproxy {
    process haproxy
    weight 2 # add 2 points of prio if OK
}

vrrp_instance VI_1 {
        state {{ keepalived_state }}
        interface eth1
        virtual_router_id 51
        priority {{ keepalived_priority }}
        authentication {
                auth_type PASS
                auth_pass {{ keepalived_auth_pass }}
        }
        virtual_ipaddress {
                {{ keepalived_ip }}/{{ keepalived_subnet }}
        }
        unicast_src_ip {{ inventory_hostname }} # this node IP

        unicast_peer {
            {% for server in groups['haproxy'] %}
                {% if hostvars[server].inventory_hostname != inventory_hostname %}
                    {{ hostvars[server].inventory_hostname }}
                {% endif %}
            {% endfor %}
        }

        track_script {
            track_haproxy
        }
}